var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s,g as n}from"./phaser-DJkhv3Fe.js";function i(e){console.error(`[ERROR] ${e.message}`),e.filename&&console.error(`File: ${e.filename} at ${e.lineNumber}:${e.columnNumber}`),e.stack&&console.error(`Stack: ${e.stack}`)}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const a=n(s());class r extends a.Loader.File{constructor(e,t,s,n){super(e,{type:"font",key:t,url:s,xhrSettings:n})}load(){const e=new FontFace(this.key,`url(${this.url})`);e.load().then((()=>{document.fonts.add(e),this.loader.emit(a.Loader.Events.FILE_PROGRESS,this,1),this.loader.nextFile(this,!0)})).catch((()=>{this.loader.nextFile(this,!1)}))}}class o extends a.Plugins.BasePlugin{constructor(e){super(e),e.registerFileType("font",this.fontFileCallback)}fontFileCallback(e,t,s){this.addFile(new r(this,e,t,s))}}const c=class e{constructor(e){t(this,"scene"),this.scene=e}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}emit(e,t){this.scene.events.emit(e,t)}on(e,t){this.scene.events.on(e,t)}once(e,t){this.scene.events.once(e,t)}off(e,t){t?this.scene.events.off(e,t):this.scene.events.off(e)}};t(c,"instance");let h=c;var l=(e=>(e.SCENE_TRANSITION_START="scene-transition-start",e.SCENE_TRANSITION_COMPLETE="scene-transition-complete",e.BOOT_COMPLETE="boot-complete",e.PRELOADER_PROGRESS="preloader-progress",e.PRELOADER_FILE_PROGRESS="preloader-file-progress",e.PRELOADER_COMPLETE="preloader-complete",e.MENU_BUTTON_CLICK="menu-button-click",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_OVER="game-over",e))(l||{});function d(e){const{scene:t,target:s,duration:n,onComplete:i}=e;t.tweens.add({targets:s,alpha:1,duration:n,onComplete:i})}function u(e){const{scene:t,target:s,duration:n,onComplete:i}=e;t.tweens.add({targets:s,alpha:0,duration:n,onComplete:i})}class g extends Phaser.Scene{constructor(e){super(e),t(this,"EVENTS",l),t(this,"eventManager"),this.eventManager=h.getInstance(this)}get cameraCenter(){return{x:this.cameras.main.centerX,y:this.cameras.main.centerY}}get cameraDimensions(){return{width:this.cameras.main.width,height:this.cameras.main.height}}applyFadeInToScene(e=1e3){this.cameras.main.setAlpha(0),d({scene:this,target:this.cameras.main,duration:e})}startSceneWithFadeOut(e,t=1e3){u({scene:this,target:this.cameras.main,duration:t,onComplete:()=>{this.scene.start(e)}})}}const E=class e extends Phaser.GameObjects.Container{constructor({scene:e,position:s,dimensions:n}){super(e,s.x,s.y),t(this,"loadingPercentText"),t(this,"loadingBar"),t(this,"MAX_WIDTH",220);const i={width:0,height:.8*n.height};this.setupBackground(n),this.setupBar(i),this.setupLoadingPercentText(),e.add.existing(this)}setupBackground(e){const t=this.scene.add.rectangle(0,0,e.width,e.height,3355443);this.add(t)}setupBar(e){this.loadingBar=this.scene.add.rectangle(0,0,e.width,e.height,16777215),this.add(this.loadingBar)}setupLoadingPercentText(){const t=e.DEFAULT_PERCENT_TEXT;this.loadingPercentText=this.scene.add.text(0,0,t,{fontSize:"11px",color:"#000000"}).setOrigin(.5),this.add(this.loadingPercentText)}updateProgress(e){if(!(e>=0&&e<=1))throw new Error("Invalid argument");const t=100*e;this.loadingPercentText.setText(`${t.toFixed(0)}%`),this.loadingBar.setSize(this.MAX_WIDTH*e,this.loadingBar.height)}};t(E,"DEFAULT_PERCENT_TEXT","0%");let m=E;function p(e){const{scene:t,target:s,duration:n,onComplete:i}=e;d({scene:t,target:s,duration:n/2,onComplete:()=>{u({scene:t,target:s,duration:n/2,onComplete:i})}})}const T=class e extends Phaser.GameObjects.Container{constructor({scene:s,x:n,y:i,text:a,background:r,onClick:o}){super(s,n,i),t(this,"textElement"),t(this,"backgroundElement"),t(this,"isEnabled",!0),r&&this.setupBackground(r),this.setupText(a??e.DEFAULT_TEXT),this.setupEvents(o??(()=>{})),this.setupHitbox(),this.scene.add.existing(this)}setupText(t){this.textElement=this.scene.add.text(0,0,t,{fontSize:e.DEFAULT_FONT_SIZE+"px"}).setOrigin(e.DEFAULT_ORIGIN),this.add(this.textElement)}setupBackground(t){this.backgroundElement=this.scene.add.image(0,0,t).setOrigin(e.DEFAULT_ORIGIN),this.add(this.backgroundElement)}setupHitbox(){const e=this.backgroundElement??this.textElement;this.setSize(e.width,e.height),this.setInteractive({useHandCursor:!0})}setupEvents(e){const t=[this.backgroundElement,this.textElement].filter(Boolean);this.onPointerOverEvent(t),this.onPointerOutEvent(t),e&&this.onClickEvent(e)}onClickEvent(e){this.on("pointerdown",(()=>{this.isEnabled&&e()}))}onPointerOverEvent(e){this.on("pointerover",(()=>{this.isEnabled&&(this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,scale:1.04,duration:100}))}))}onPointerOutEvent(e){this.on("pointerout",(()=>{this.isEnabled&&(this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,scale:1,duration:100}))}))}setEnabled(e){const t=e?1:.5;this.isEnabled=e,this.setAlpha(t),this.disableInteractive(),e&&this.setInteractive({useHandCursor:!0})}destroy(e){this.removeAllListeners(),super.destroy(e)}};t(T,"DEFAULT_FONT_SIZE",10),t(T,"DEFAULT_TEXT","Click me"),t(T,"DEFAULT_ORIGIN",.5);let x=T;window.addEventListener("error",(function(e){const{message:t,filename:s,lineno:n,colno:a,error:r}=e;i({message:t,filename:s,lineNumber:n,columnNumber:a,stack:null==r?void 0:r.stack})})),window.addEventListener("unhandledrejection",(function(e){const t=e.reason;i({message:(null==t?void 0:t.message)||"Unhandled Promise Rejection",stack:(null==t?void 0:t.stack)||String(t)})}));const P={title:"A ruína de Arquimedes",type:a.WEBGL,pixelArt:!0,scale:{mode:a.Scale.FIT,autoCenter:a.Scale.CENTER_BOTH,width:427,height:240},parent:"game-container",render:{antialias:!1,antialiasGL:!1,pixelArt:!0},roundPixels:!0,physics:{default:"arcade",arcade:{debug:!1,fps:24,timeScale:1,gravity:{x:0,y:0},tileBias:16}},plugins:{global:[{key:"FontPlugin",plugin:o,start:!0}]},scene:[class extends g{constructor(){super("Boot")}init(){this.scene.launch("BootUI"),this.setupEvents()}preload(){this.load.setPath("assets"),this.load.font("alagardFont","alagard_by_pix3m.ttf"),this.load.font("romulusFont","romulus_by_pix3m.ttf")}setupEvents(){this.load.on("complete",this.loadComplete,this)}loadComplete(){var e;null==(e=this.input.keyboard)||e.on("keydown",this.handleInputs,this),this.input.on("pointerdown",this.handleInputs,this)}handleInputs(){this.scene.start("Preloader"),this.eventManager.emit(l.BOOT_COMPLETE)}},class extends g{constructor(){super("BootUI")}init(){this.createUI(),this.setupLoadingEvents()}setupLoadingEvents(){this.eventManager.on(this.EVENTS.BOOT_COMPLETE,(()=>this.scene.stop(this)))}createUI(){const e=this.cameraCenter;this.createContinueText(e)}createContinueText(e){!function(e){const{scene:t,target:s,othersConfigs:n}=e;t.tweens.add({targets:s,alpha:n.alpha||0,duration:n.duration||1e3,yoyo:n.yoyo||!0,repeat:n.repeat||-1})}({scene:this,target:this.add.text(e.x,e.y,"Press any key or click to start the game",{fontSize:12}).setOrigin(.5),othersConfigs:{duration:1e3}})}},class extends g{constructor(){super("Preloader")}init(){this.scene.launch("PreloaderUI"),this.setupEvents()}preload(){this.load.setPath("assets"),this.load.image("logo","logos/logo_en.png"),this.load.image("logo-phaser","logos/logo_phaser.png"),this.load.image("background","backgrounds/background_test.png"),this.load.image("button","buttons/button-test.png")}setupEvents(){this.load.on("progress",this.handleProgress,this),this.load.on("fileprogress",this.handleFileProgress,this),this.load.on("complete",this.loadComplete,this)}handleProgress(e){this.eventManager.emit(this.EVENTS.PRELOADER_PROGRESS,e)}handleFileProgress(e){this.eventManager.emit(this.EVENTS.PRELOADER_FILE_PROGRESS,e)}loadComplete(){this.eventManager.emit(this.EVENTS.PRELOADER_COMPLETE,1e3),setTimeout((()=>this.scene.start("Intro")),1e3)}},class extends g{constructor(){super("PreloaderUI"),t(this,"loadingBar"),t(this,"currentAssetInLoadingText")}init(){this.createUI(),this.setupLoadingEvents()}setupLoadingEvents(){this.eventManager.on(this.EVENTS.PRELOADER_PROGRESS,(e=>this.loadingBar.updateProgress(e))),this.eventManager.on(this.EVENTS.PRELOADER_FILE_PROGRESS,(e=>this.updateCurrentAssetText(e))),this.eventManager.on(this.EVENTS.PRELOADER_COMPLETE,(e=>u({scene:this,target:this.cameras.main,duration:e})))}createUI(){const e=this.cameraCenter,t={x:e.x,y:1.05*e.y},s={x:e.x,y:.9*e.y},n={x:e.x,y:1.18*e.y};this.createLoadingBar(t,{width:226,height:16}),this.createStaticLoadingText(s),this.createCurrentAssetText(n)}createLoadingBar(e,t){this.loadingBar=new m({scene:this,position:e,dimensions:t})}createStaticLoadingText(e){this.add.text(e.x,e.y,"Loading").setOrigin(.5)}createCurrentAssetText(e){this.currentAssetInLoadingText=this.add.text(e.x,e.y,"Asset: ",{color:"#c1c1c1",fontSize:10}).setOrigin(.5)}updateCurrentAssetText(e){this.currentAssetInLoadingText.setText(`Asset: ${e.key}`)}},class extends g{constructor(){super("Intro"),t(this,"DEFAULT_DELAY",3e3),t(this,"TEXT_STYLE",{fontSize:14,color:"#fff",align:"center"})}init(){this.applyFadeInToScene()}create(){this.createBackground();const e=this.cameraCenter,t=.7*e.y;this.showPhaserIntro(e,t)}createBackground(){const e=this.cameraDimensions;this.add.image(e.width/2,e.height/2,"background").setDisplaySize(e.width,e.height).setAlpha(.13,0,0,.13)}showPhaserIntro(e,t){p({scene:this,target:this.createIntroElements(e,t,"logo-phaser",.03,"Powered by Phaser"),duration:this.DEFAULT_DELAY,onComplete:()=>{this.showGameIntro(e,t)}})}showGameIntro(e,t){p({scene:this,target:this.createIntroElements(e,t,"logo",.25,"A Ruína de Arquimedes"),duration:this.DEFAULT_DELAY,onComplete:()=>{this.transitionToMainMenu()}})}createIntroElements(e,t,s,n,i){const a=this.add.image(e.x,t,s).setScale(n).setAlpha(0),r=1.4*e.y;return[a,this.add.text(e.x,r,i,this.TEXT_STYLE).setOrigin(.5).setAlpha(0)]}transitionToMainMenu(){this.startSceneWithFadeOut("MainMenu")}},class extends g{constructor(){super("MainMenu")}init(){this.applyFadeInToScene()}create(){this.createBackground(),this.createLogo(),this.createPrincipalButtons()}createBackground(){const e=this.cameraDimensions,t={x:e.width/2,y:e.height/2};this.add.image(t.x,t.y,"background").setDisplaySize(e.width,e.height).setAlpha(0,0,0,.3)}createLogo(){const e={x:85,y:.5*this.cameraCenter.y};this.add.image(e.x,e.y,"logo").setDisplaySize(150,75).setOrigin(.5)}createPrincipalButtons(){const e=[{text:"Start",callback:()=>{this.eventManager.emit(this.EVENTS.MENU_BUTTON_CLICK,{button:"start"}),this.scene.start("InProgressScene")}},{text:"Options",callback:()=>{this.eventManager.emit(this.EVENTS.MENU_BUTTON_CLICK,{button:"options"})}},{text:"Credits",callback:()=>{this.eventManager.emit(this.EVENTS.MENU_BUTTON_CLICK,{button:"credits"})}},{text:"Exit",callback:()=>{this.eventManager.emit(this.EVENTS.MENU_BUTTON_CLICK,{button:"exit"})}}],t=this.cameraCenter.y;e.forEach(((e,s)=>{new x({scene:this,x:30,y:t+18*s,text:e.text,onClick:e.callback})}))}},class extends g{constructor(){super("MainGame")}create(){}},class extends g{constructor(){super("GameOver")}create(){}},class extends g{constructor(){super("InProgressScene")}create(){this.createLogo(),this.createInProgressText()}createLogo(){const e={x:this.cameraCenter.x,y:.5*this.cameraCenter.y};this.add.image(e.x,e.y,"logo").setDisplaySize(200,100)}createInProgressText(){const e={x:this.cameraCenter.x,y:1.3*this.cameraCenter.y};this.add.text(e.x,e.y,"IN PROGRESS.").setOrigin(.5)}}]};new a.Game(P);
